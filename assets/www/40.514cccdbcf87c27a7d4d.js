(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{"8IdJ":function(e,o,t){"use strict";t.r(o),t.d(o,"AddonModBookLazyModule",(function(){return F}));var n=t("tyNb"),a=t("L3Fv"),d=t("JktO"),i=t("ghUQ"),c=t("x+LU"),s=t("fXoL"),r=t("TEn/"),l=t("4JiN"),u=t("hMzs"),h=t("nt/U"),g=t("sYmb");let m=(()=>{class AddonModBookIndexPage extends i.a{}return AddonModBookIndexPage.ɵfac=function AddonModBookIndexPage_Factory(e){return p(e||AddonModBookIndexPage)},AddonModBookIndexPage.ɵcmp=s.sc({type:AddonModBookIndexPage,selectors:[["page-addon-mod-book-index"]],viewQuery:function AddonModBookIndexPage_Query(e,o){var t;(1&e&&s.ud(c.a,!0),2&e)&&(s.dd(t=s.Nc())&&(o.activityComponent=t.first))},features:[s.ic],decls:14,vars:12,consts:[["collapsible",""],["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"module","courseId","dataRetrieved"]],template:function AddonModBookIndexPage_Template(e,o){1&e&&(s.Ec(0,"ion-header",0),s.Ec(1,"ion-toolbar"),s.Ec(2,"ion-buttons",1),s.zc(3,"ion-back-button",2),s.Pc(4,"translate"),s.Dc(),s.Ec(5,"ion-title"),s.Ec(6,"h1"),s.zc(7,"core-format-text",3),s.Dc(),s.Dc(),s.zc(8,"ion-buttons",4),s.Dc(),s.Dc(),s.Ec(9,"ion-content",5),s.Ec(10,"ion-refresher",6),s.Mc("ionRefresh",(function AddonModBookIndexPage_Template_ion_refresher_ionRefresh_10_listener(e){return null==o.activityComponent?null:o.activityComponent.doRefresh(e.target)})),s.zc(11,"ion-refresher-content",7),s.Pc(12,"translate"),s.Dc(),s.Ec(13,"addon-mod-book-index",8),s.Mc("dataRetrieved",(function AddonModBookIndexPage_Template_addon_mod_book_index_dataRetrieved_13_listener(e){return o.updateData(e)})),s.Dc(),s.Dc()),2&e&&(s.lc(3),s.Vc("text",s.Qc(4,8,"core.back")),s.lc(4),s.Vc("text",o.title)("contextInstanceId",null==o.module?null:o.module.id)("courseId",o.courseId),s.lc(3),s.Vc("disabled",null==o.activityComponent?null:o.activityComponent.showLoading),s.lc(1),s.Wc("pullingText",s.Qc(12,10,"core.pulltorefresh")),s.lc(2),s.Vc("module",o.module)("courseId",o.courseId))},directives:[r.C,l.b,r.Ab,r.m,r.h,r.i,r.yb,u.a,h.a,r.v,r.bb,r.cb,c.a],pipes:[g.d],encapsulation:2}),AddonModBookIndexPage})();const p=s.Gc(m);var v=t("yQkb"),_=t("mrSG"),f=t("BaYo"),I=t("93ts"),b=t("kBKO"),M=t("qwWh"),k=t("MpCO"),C=t("ULAo"),y=t("zbKZ"),B=t("kWmn"),x=t("GGba"),A=t("pHTc"),P=t("3LXp"),D=t("vuGA"),E=t("bFG1"),w=t("j3ag"),O=t("Fb4V"),T=t("7ZBW"),L=t("ofXK"),R=t("PgjG"),S=t("ACYt"),V=t("3CSS"),z=t("vSVd"),N=t("/BoF"),U=t("3jOR");function AddonModBookContentsPage_ion_button_9_Template(e,o){if(1&e){const e=s.Fc();s.Ec(0,"ion-button",12),s.Mc("click",(function AddonModBookContentsPage_ion_button_9_Template_ion_button_click_0_listener(){s.fd(e);return s.Oc().showToc()})),s.Pc(1,"translate"),s.zc(2,"ion-icon",13),s.Dc()}2&e&&s.mc("aria-label",s.Qc(1,1,"addon.mod_book.toc"))}function AddonModBookContentsPage_ion_card_16_Template(e,o){if(1&e&&(s.Ec(0,"ion-card",14),s.Ec(1,"ion-item"),s.zc(2,"ion-icon",15),s.Ec(3,"ion-label"),s.zc(4,"span",16),s.Dc(),s.Dc(),s.Dc()),2&e){const e=s.Oc();s.lc(4),s.Vc("innerHTML",e.warning,s.gd)}}function AddonModBookContentsPage_ng_template_18_div_2_Template(e,o){if(1&e&&(s.Ec(0,"div",20),s.Ec(1,"strong"),s.pd(2),s.Pc(3,"translate"),s.Dc(),s.zc(4,"core-tag-list",21),s.Dc()),2&e){const e=s.Oc().item;s.lc(2),s.rd("",s.Qc(3,2,"core.tag.tags"),": "),s.lc(2),s.Vc("tags",e.tags)}}function AddonModBookContentsPage_ng_template_18_Template(e,o){if(1&e&&(s.Ec(0,"div",17),s.zc(1,"core-format-text",18),s.nd(2,AddonModBookContentsPage_ng_template_18_div_2_Template,5,4,"div",19),s.Dc()),2&e){const e=o.item,t=o.active,n=s.Oc();s.lc(1),s.Vc("component",n.component)("componentId",n.cmId)("text",e.content)("contextInstanceId",n.cmId)("courseId",n.courseId)("disabled",!t),s.lc(1),s.Vc("ngIf",(null==e.tags?null:e.tags.length)>0)}}function AddonModBookContentsPage_core_navigation_bar_19_Template(e,o){if(1&e){const e=s.Fc();s.Ec(0,"core-navigation-bar",22),s.Mc("action",(function AddonModBookContentsPage_core_navigation_bar_19_Template_core_navigation_bar_action_0_listener(o){s.fd(e);return s.Oc().changeChapter(o.id)})),s.Dc()}if(2&e){const e=s.Oc();s.Vc("items",e.navigationItems)}}let j=(()=>{class AddonModBookContentsPage{constructor(){this.title="",this.component=T.b.COMPONENT,this.warning="",this.displayNavBar=!0,this.navigationItems=[],this.slidesOpts={autoHeight:!0,observer:!0,observeParents:!0,scrollOnChange:"top"},this.loaded=!1}ngOnInit(){try{this.cmId=A.a.getRequiredRouteNumberParam("cmId"),this.courseId=A.a.getRequiredRouteNumberParam("courseId"),this.initialChapterId=A.a.getRouteNumberParam("chapterId")}catch(e){return P.a.showErrorModal(e),A.a.back(),void 0}const e=new contents_AddonModBookSlidesItemsManagerSource(this.courseId,this.cmId,B.a.areTagsAvailableInSite(),this.initialChapterId);this.manager=new b.a(e),this.managerUnsubscribe=this.manager.addListener({onSelectedItemUpdated:e=>{this.onChapterViewed(e.id)}}),this.fetchContent()}get module(){var e;return null===(e=this.manager)||void 0===e?void 0:e.getSource().module}get book(){var e;return null===(e=this.manager)||void 0===e?void 0:e.getSource().book}get chapters(){var e;return(null===(e=this.manager)||void 0===e?void 0:e.getSource().chapters)||[]}fetchContent(e=!1){var o;return Object(_.a)(this,void 0,void 0,(function*(){try{const t=null===(o=this.manager)||void 0===o?void 0:o.getSource();if(!t)return;const{module:n,book:a}=yield t.loadBookData(),d=yield this.downloadResourceIfNeeded(n,e);if(this.displayNavBar=0!=a.navstyle,this.title=a.name,yield t.loadContents(),yield t.load(),null==d?void 0:d.failed){const e=D.a.getErrorMessageFromError(d.error)||d.error;this.warning=w.I.instant("core.errordownloadingsomefiles")+(e?" "+e:"")}else this.warning=""}catch(e){P.a.showErrorModalDefault(e,"core.course.errorgetmodule",!0)}finally{this.loaded=!0}}))}downloadResourceIfNeeded(e,o=!1){var t;return Object(_.a)(this,void 0,void 0,(function*(){const n={failed:!1};let a=!1;if((yield y.a.getModuleStatus(e,this.courseId,void 0,o))!==f.a.DOWNLOADED)try{yield y.a.downloadModule(e,this.courseId),a=!0}catch(e){n.failed=!0,n.error=e}if(!(null===(t=e.contents)||void 0===t?void 0:t.length)||o&&!a){const t=o&&x.a.isOnline();try{yield C.a.loadModuleContents(e,void 0,void 0,!1,t)}catch(o){if(t&&!e.contents)yield C.a.loadModuleContents(e);else if(!e.contents)throw o}}return n}))}changeChapter(e){var o;e&&(null===(o=this.slides)||void 0===o?void 0:o.slideToItem({id:e}))}doRefresh(e){return Object(_.a)(this,void 0,void 0,(function*(){this.manager&&(yield E.a.ignoreErrors(Promise.all([this.manager.getSource().invalidateContent(),y.a.invalidateCourseUpdates(this.courseId)]))),yield E.a.ignoreErrors(this.fetchContent(!0)),null==e||e.complete()}))}showToc(){var e;return Object(_.a)(this,void 0,void 0,(function*(){const o=null===(e=this.manager)||void 0===e?void 0:e.getSelectedItem(),t=yield P.a.openSideModal({component:O.a,componentProps:{moduleId:this.cmId,chapters:this.chapters,selected:null==o?void 0:o.id,courseId:this.courseId,book:this.book}});t&&this.changeChapter(t)}))}onChapterViewed(e){return Object(_.a)(this,void 0,void 0,(function*(){if(this.displayNavBar&&(this.navigationItems=this.getNavigationItems(e)),this.book&&T.a.storeLastChapterViewed(this.book.id,e,this.courseId),!this.module)return;yield E.a.ignoreErrors(T.a.logView(this.module.instance,e,this.module.name));const o=this.chapters.findIndex((o=>o.id==e));(o<0||void 0===this.chapters[o+1])&&C.a.checkModuleCompletion(this.courseId,this.module.completiondata)}))}getNavigationItems(e){return this.chapters.map((o=>({item:o,title:o.title,current:o.id==e,enabled:!0})))}ngOnDestroy(){var e,o;null===(e=this.manager)||void 0===e?void 0:e.destroy(),null===(o=this.managerUnsubscribe)||void 0===o||o.call(this),delete this.manager}}return AddonModBookContentsPage.ɵfac=function AddonModBookContentsPage_Factory(e){return new(e||AddonModBookContentsPage)},AddonModBookContentsPage.ɵcmp=s.sc({type:AddonModBookContentsPage,selectors:[["page-addon-mod-book-contents"]],viewQuery:function AddonModBookContentsPage_Query(e,o){var t;(1&e&&s.ud(k.a,!0),2&e)&&(s.dd(t=s.Nc())&&(o.slides=t.first))},decls:20,vars:16,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],["aria-haspopup","true",3,"click",4,"ngIf"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[1,"safe-area-padding-horizontal","core-swipe-slides-container"],["class","core-warning-card",4,"ngIf"],[3,"manager","options"],["collapsible-footer","","appearOnBottom","","previousTranslate","addon.mod_book.navprevtitle","nextTranslate","addon.mod_book.navnexttitle","slot","fixed",3,"items","action",4,"ngIf"],["aria-haspopup","true",3,"click"],["name","fas-bookmark","slot","icon-only","aria-hidden","true"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],[3,"innerHTML"],[1,"ion-padding"],["contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId","disabled"],["class","ion-margin-top",4,"ngIf"],[1,"ion-margin-top"],[3,"tags"],["collapsible-footer","","appearOnBottom","","previousTranslate","addon.mod_book.navprevtitle","nextTranslate","addon.mod_book.navnexttitle","slot","fixed",3,"items","action"]],template:function AddonModBookContentsPage_Template(e,o){1&e&&(s.Ec(0,"ion-header"),s.Ec(1,"ion-toolbar"),s.Ec(2,"ion-buttons",0),s.zc(3,"ion-back-button",1),s.Pc(4,"translate"),s.Dc(),s.Ec(5,"ion-title"),s.Ec(6,"h1"),s.zc(7,"core-format-text",2),s.Dc(),s.Dc(),s.Ec(8,"ion-buttons",3),s.nd(9,AddonModBookContentsPage_ion_button_9_Template,3,3,"ion-button",4),s.Dc(),s.Dc(),s.Dc(),s.Ec(10,"ion-content"),s.Ec(11,"ion-refresher",5),s.Mc("ionRefresh",(function AddonModBookContentsPage_Template_ion_refresher_ionRefresh_11_listener(e){return o.doRefresh(e.target)})),s.zc(12,"ion-refresher-content",6),s.Pc(13,"translate"),s.Dc(),s.Ec(14,"core-loading",7),s.Ec(15,"div",8),s.nd(16,AddonModBookContentsPage_ion_card_16_Template,5,1,"ion-card",9),s.Ec(17,"core-swipe-slides",10),s.nd(18,AddonModBookContentsPage_ng_template_18_Template,3,7,"ng-template"),s.Dc(),s.Dc(),s.Dc(),s.nd(19,AddonModBookContentsPage_core_navigation_bar_19_Template,1,1,"core-navigation-bar",11),s.Dc()),2&e&&(s.lc(3),s.Vc("text",s.Qc(4,12,"core.back")),s.lc(4),s.Vc("text",o.title)("contextInstanceId",o.cmId)("courseId",o.courseId),s.lc(2),s.Vc("ngIf",o.loaded),s.lc(2),s.Vc("disabled",!o.loaded),s.lc(1),s.Wc("pullingText",s.Qc(13,14,"core.pulltorefresh")),s.lc(2),s.Vc("hideUntil",o.loaded),s.lc(2),s.Vc("ngIf",o.warning),s.lc(1),s.Vc("manager",o.manager)("options",o.slidesOpts),s.lc(2),s.Vc("ngIf",o.loaded&&o.displayNavBar&&o.navigationItems.length>1))},directives:[r.C,r.Ab,r.m,r.h,r.i,r.yb,u.a,L.t,h.a,r.v,r.bb,r.cb,R.a,k.a,S.a,r.l,r.D,V.a,r.n,r.I,r.O,z.a,N.a,U.a],pipes:[g.d],styles:["[_nghost-%COMP%]   .core-swipe-slides-container[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]{flex:none}"]}),AddonModBookContentsPage})();class contents_AddonModBookSlidesItemsManagerSource extends M.a{constructor(e,o,t,n){super(n?{id:n}:void 0),this.chapters=[],this.contentsMap={},this.COURSE_ID=e,this.CM_ID=o,this.TAGS_ENABLED=t}getItemId(e){return e.id}loadBookData(){return Object(_.a)(this,void 0,void 0,(function*(){if(this.module=yield C.a.getModule(this.CM_ID,this.COURSE_ID),this.book=yield T.a.getBook(this.COURSE_ID,this.CM_ID),!this.initialItem){const e=yield T.a.getLastChapterViewed(this.book.id);e&&(this.initialItem={id:e})}return{module:this.module,book:this.book}}))}loadContents(){return Object(_.a)(this,void 0,void 0,(function*(){if(!this.module)return;const e=yield C.a.getModuleContents(this.module,this.COURSE_ID);this.contentsMap=T.a.getContentsMap(e),this.chapters=T.a.getTocList(e)}))}loadItems(){return Object(_.a)(this,void 0,void 0,(function*(){try{return yield Promise.all(this.chapters.map((e=>Object(_.a)(this,void 0,void 0,(function*(){const o=yield T.a.getChapterContent(this.contentsMap,e.id,this.CM_ID);return{id:e.id,content:o,tags:this.TAGS_ENABLED?this.contentsMap[e.id].tags:[]}})))))}catch(e){if(!D.a.getErrorMessageFromError(e))throw new I.a(w.I.instant("addon.mod_book.errorchapter"));throw e}}))}invalidateContent(){return T.a.invalidateContent(this.CM_ID,this.COURSE_ID)}}const Q=[{path:":courseId/:cmId",component:m},{path:":courseId/:cmId/contents",component:j}];let F=(()=>{class AddonModBookLazyModule{}return AddonModBookLazyModule.ɵmod=s.wc({type:AddonModBookLazyModule}),AddonModBookLazyModule.ɵinj=s.vc({factory:function AddonModBookLazyModule_Factory(e){return new(e||AddonModBookLazyModule)},imports:[[n.m.forChild(Q),a.a,d.a,v.a]]}),AddonModBookLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&s.kd(F,{declarations:[m,j],imports:[n.m,a.a,d.a,v.a]}))}}]);