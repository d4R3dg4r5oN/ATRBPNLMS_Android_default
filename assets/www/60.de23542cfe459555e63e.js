(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{gq5R:function(e,i,t){"use strict";t.r(i),t.d(i,"AddonPrivateFilesLazyModule",(function(){return O}));var o=t("L3Fv"),n=t("mrSG"),a=t("kScs"),l=t("GGba"),r=t("9+EE"),c=t("3LXp"),s=t("vuGA"),d=t("j3ag"),_=t("fjkH"),f=t("tP62"),u=t("S7NA"),p=t("bFG1"),h=t("pHTc"),g=t("fXoL"),m=t("TEn/"),P=t("nt/U"),v=t("ofXK"),F=t("PgjG"),b=t("rf3J"),I=t("3CSS"),x=t("5450"),y=t("r8G5"),A=t("yNDK"),w=t("sYmb");function AddonPrivateFilesIndexPage_core_loading_12_core_combobox_1_Template(e,i){if(1&e){const e=g.Fc();g.Ec(0,"core-combobox",12),g.Mc("onChange",(function AddonPrivateFilesIndexPage_core_loading_12_core_combobox_1_Template_core_combobox_onChange_0_listener(i){g.fd(e);return g.Oc(2).rootChanged(i)})),g.Ec(1,"ion-select-option",13),g.pd(2),g.Pc(3,"translate"),g.Dc(),g.Ec(4,"ion-select-option",14),g.pd(5),g.Pc(6,"translate"),g.Dc(),g.Dc()}if(2&e){const e=g.Oc(2);g.Vc("selection",e.root),g.lc(2),g.rd(" ",g.Qc(3,3,"addon.privatefiles.privatefiles")," "),g.lc(3),g.rd(" ",g.Qc(6,5,"addon.privatefiles.sitefiles")," ")}}const _c0=function(e,i){return{used:e,total:i}},_c1=function(e){return{$a:e}};function AddonPrivateFilesIndexPage_core_loading_12_ion_card_2_Template(e,i){if(1&e&&(g.Ec(0,"ion-card",15),g.Ec(1,"ion-item"),g.Ec(2,"ion-label"),g.pd(3),g.Pc(4,"translate"),g.Dc(),g.Dc(),g.Dc()),2&e){const e=g.Oc(2);g.lc(3),g.rd(" ",g.Rc(4,1,"core.quotausage",g.ad(7,_c1,g.bd(4,_c0,e.spaceUsed,e.userQuotaReadable)))," ")}}function AddonPrivateFilesIndexPage_core_loading_12_ion_list_3_ng_container_1_ion_item_1_Template(e,i){if(1&e){const e=g.Fc();g.Ec(0,"ion-item",19),g.Mc("click",(function AddonPrivateFilesIndexPage_core_loading_12_ion_list_3_ng_container_1_ion_item_1_Template_ion_item_click_0_listener(){g.fd(e);const i=g.Oc().$implicit;return g.Oc(3).openFolder(i)})),g.zc(1,"ion-icon",20),g.Pc(2,"translate"),g.Ec(3,"ion-label"),g.pd(4),g.Dc(),g.Dc()}if(2&e){const e=g.Oc().$implicit;g.lc(1),g.mc("aria-label",g.Qc(2,2,"core.folder")),g.lc(3),g.qd(e.filename)}}function AddonPrivateFilesIndexPage_core_loading_12_ion_list_3_ng_container_1_core_file_2_Template(e,i){if(1&e&&g.zc(0,"core-file",21),2&e){const e=g.Oc().$implicit,i=g.Oc(3);g.Vc("file",e)("component",i.component)("componentId",e.contextid)}}function AddonPrivateFilesIndexPage_core_loading_12_ion_list_3_ng_container_1_Template(e,i){if(1&e&&(g.Cc(0),g.nd(1,AddonPrivateFilesIndexPage_core_loading_12_ion_list_3_ng_container_1_ion_item_1_Template,5,4,"ion-item",17),g.nd(2,AddonPrivateFilesIndexPage_core_loading_12_ion_list_3_ng_container_1_core_file_2_Template,1,3,"core-file",18),g.Bc()),2&e){const e=i.$implicit;g.lc(1),g.Vc("ngIf",e.isdir),g.lc(1),g.Vc("ngIf",!e.isdir)}}function AddonPrivateFilesIndexPage_core_loading_12_ion_list_3_Template(e,i){if(1&e&&(g.Ec(0,"ion-list"),g.nd(1,AddonPrivateFilesIndexPage_core_loading_12_ion_list_3_ng_container_1_Template,3,2,"ng-container",16),g.Dc()),2&e){const e=g.Oc(2);g.lc(1),g.Vc("ngForOf",e.files)}}function AddonPrivateFilesIndexPage_core_loading_12_core_empty_box_4_Template(e,i){1&e&&(g.zc(0,"core-empty-box",22),g.Pc(1,"translate")),2&e&&g.Vc("message",g.Qc(1,1,"addon.privatefiles.emptyfilelist"))}function AddonPrivateFilesIndexPage_core_loading_12_Template(e,i){if(1&e&&(g.Ec(0,"core-loading",7),g.nd(1,AddonPrivateFilesIndexPage_core_loading_12_core_combobox_1_Template,7,7,"core-combobox",8),g.nd(2,AddonPrivateFilesIndexPage_core_loading_12_ion_card_2_Template,5,9,"ion-card",9),g.nd(3,AddonPrivateFilesIndexPage_core_loading_12_ion_list_3_Template,2,1,"ion-list",10),g.nd(4,AddonPrivateFilesIndexPage_core_loading_12_core_empty_box_4_Template,2,3,"core-empty-box",11),g.Dc()),2&e){const e=g.Oc();g.Vc("hideUntil",e.filesLoaded),g.lc(1),g.Vc("ngIf",e.showPrivateFiles&&e.showSiteFiles&&!e.path),g.lc(1),g.Vc("ngIf",e.userQuota&&e.filesInfo&&e.filesInfo.filecount>0),g.lc(1),g.Vc("ngIf",e.files&&e.files.length>0),g.lc(1),g.Vc("ngIf",!e.files||!e.files.length)}}function AddonPrivateFilesIndexPage_ion_fab_13_Template(e,i){if(1&e){const e=g.Fc();g.Ec(0,"ion-fab",23),g.Ec(1,"ion-fab-button",24),g.Mc("click",(function AddonPrivateFilesIndexPage_ion_fab_13_Template_ion_fab_button_click_1_listener(){g.fd(e);return g.Oc().uploadFile()})),g.Pc(2,"translate"),g.zc(3,"ion-icon",25),g.Ec(4,"span",26),g.pd(5),g.Pc(6,"translate"),g.Dc(),g.Dc(),g.Dc()}2&e&&(g.lc(1),g.mc("aria-label",g.Qc(2,2,"core.fileuploader.uploadafile")),g.lc(4),g.qd(g.Qc(6,4,"core.fileuploader.uploadafile")))}let E=(()=>{class AddonPrivateFilesIndexPage{constructor(){this.filesLoaded=!1,this.updateSiteObserver=_.b.on(_.b.SITE_UPDATED,(()=>{this.setVisibility()}),r.c.getCurrentSiteId())}ngOnInit(){var e,i,t;try{this.root=h.a.getRouteParam("root");const e=h.a.getRouteNumberParam("contextid");e&&(this.path={contextid:e,component:h.a.getRequiredRouteParam("component"),filearea:h.a.getRequiredRouteParam("filearea"),itemid:h.a.getRequiredRouteNumberParam("itemid"),filepath:h.a.getRequiredRouteParam("filepath"),filename:h.a.getRequiredRouteParam("filename")})}catch(e){return c.a.showErrorModal(e),h.a.back(),void 0}this.title=(null===(e=this.path)||void 0===e?void 0:e.filename)||d.I.instant("addon.privatefiles.files"),this.setVisibility(),this.userQuota=null===(t=null===(i=r.c.getCurrentSite())||void 0===i?void 0:i.getInfo())||void 0===t?void 0:t.userquota,this.root||(this.showPrivateFiles?this.root="my":this.showSiteFiles&&(this.root="site")),this.root?this.rootChanged(this.root):this.filesLoaded=!0}setVisibility(){this.showPrivateFiles=f.a.canViewPrivateFiles(),this.showSiteFiles=f.a.canViewSiteFiles(),this.showUpload=f.a.canUploadFiles()}refreshData(e){this.refreshFiles().finally((()=>{null==e?void 0:e.complete()}))}rootChanged(e){this.root=e,this.filesLoaded=!1,this.component="my"==this.root?f.b.PRIVATE_FILES_COMPONENT:f.b.SITE_FILES_COMPONENT,this.fetchFiles().finally((()=>{this.filesLoaded=!0}))}uploadFile(){return Object(n.a)(this,void 0,void 0,(function*(){if(!l.a.isOnline())return c.a.showErrorModal("core.fileuploader.errormustbeonlinetoupload",!0),void 0;try{yield u.a.uploadPrivateFile(this.filesInfo),this.filesLoaded=!1,yield p.a.ignoreErrors(this.refreshFiles()),this.filesLoaded=!0}catch(e){c.a.showErrorModalDefault(e,"core.fileuploader.errorwhileuploading",!0)}}))}fetchFiles(){return Object(n.a)(this,void 0,void 0,(function*(){try{if(this.path)return this.files=yield f.a.getFiles(this.path),void 0;"site"==this.root?(this.title=d.I.instant("addon.privatefiles.sitefiles"),this.files=yield f.a.getSiteFiles()):"my"==this.root?(this.title=d.I.instant("addon.privatefiles.files"),this.files=yield f.a.getPrivateFiles(),this.showUpload&&this.userQuota&&this.userQuota>0?(this.filesInfo=yield f.a.getPrivateFilesInfo(),this.spaceUsed=s.a.bytesToSize(this.filesInfo.filesizewithoutreferences,1),this.userQuotaReadable=s.a.bytesToSize(this.userQuota,1)):delete this.userQuota):c.a.showErrorModal("addon.privatefiles.couldnotloadfiles",!0)}catch(e){c.a.showErrorModalDefault(e,"addon.privatefiles.couldnotloadfiles",!0)}}))}refreshFiles(){return Object(n.a)(this,void 0,void 0,(function*(){try{yield Promise.all([f.a.invalidateDirectory(this.root,this.path),f.a.invalidatePrivateFilesInfoForUser()])}finally{yield this.fetchFiles()}}))}openFolder(e){const i={contextid:e.contextid,component:e.component||"",filearea:e.filearea||"",itemid:e.itemid||0,filepath:e.filepath||"",filename:e.filename||""};e.component&&(i.filename="");const t=a.Md5.hashAsciiStr(JSON.stringify(i));h.a.navigate(`../${t}`,{params:i})}ngOnDestroy(){var e;null===(e=this.updateSiteObserver)||void 0===e?void 0:e.off()}}return AddonPrivateFilesIndexPage.ɵfac=function AddonPrivateFilesIndexPage_Factory(e){return new(e||AddonPrivateFilesIndexPage)},AddonPrivateFilesIndexPage.ɵcmp=g.sc({type:AddonPrivateFilesIndexPage,selectors:[["page-addon-privatefiles-index"]],decls:14,vars:10,consts:[["slot","start"],[3,"text"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil",4,"ngIf"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end",4,"ngIf"],[3,"hideUntil"],[3,"selection","onChange",4,"ngIf"],["class","core-info-card",4,"ngIf"],[4,"ngIf"],["icon","far-folder-open",3,"message",4,"ngIf"],[3,"selection","onChange"],["value","my",1,"ion-text-wrap"],["value","site",1,"ion-text-wrap"],[1,"core-info-card"],[4,"ngFor","ngForOf"],["button","","class","ion-text-wrap item-file item-directory","detail","true",3,"click",4,"ngIf"],[3,"file","component","componentId",4,"ngIf"],["button","","detail","true",1,"ion-text-wrap","item-file","item-directory",3,"click"],["name","fas-folder","slot","start"],[3,"file","component","componentId"],["icon","far-folder-open",3,"message"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],[3,"click"],["name","fas-plus","aria-hidden","true"],[1,"sr-only"]],template:function AddonPrivateFilesIndexPage_Template(e,i){1&e&&(g.Ec(0,"ion-header"),g.Ec(1,"ion-toolbar"),g.Ec(2,"ion-buttons",0),g.zc(3,"ion-back-button",1),g.Pc(4,"translate"),g.Dc(),g.Ec(5,"ion-title"),g.Ec(6,"h1"),g.pd(7),g.Dc(),g.Dc(),g.Dc(),g.Dc(),g.Ec(8,"ion-content",2),g.Ec(9,"ion-refresher",3),g.Mc("ionRefresh",(function AddonPrivateFilesIndexPage_Template_ion_refresher_ionRefresh_9_listener(e){return i.refreshData(e.target)})),g.zc(10,"ion-refresher-content",4),g.Pc(11,"translate"),g.Dc(),g.nd(12,AddonPrivateFilesIndexPage_core_loading_12_Template,5,5,"core-loading",5),g.nd(13,AddonPrivateFilesIndexPage_ion_fab_13_Template,7,6,"ion-fab",6),g.Dc()),2&e&&(g.lc(3),g.Vc("text",g.Qc(4,6,"core.back")),g.lc(4),g.qd(i.title),g.lc(2),g.Vc("disabled",!i.filesLoaded||!i.showPrivateFiles&&!i.showSiteFiles),g.lc(1),g.Wc("pullingText",g.Qc(11,8,"core.pulltorefresh")),g.lc(2),g.Vc("ngIf",i.showPrivateFiles||i.showSiteFiles),g.lc(1),g.Vc("ngIf",i.showUpload&&"site"!=i.root&&!i.path))},directives:[m.C,m.Ab,m.m,m.h,m.i,m.yb,P.a,m.v,m.bb,m.cb,v.t,F.a,b.a,m.mb,m.n,m.I,m.O,m.P,v.s,m.D,I.a,x.a,y.a,m.x,A.a,m.y],pipes:[w.d],encapsulation:2}),AddonPrivateFilesIndexPage})();var T=t("tyNb"),D=t("wG2S");function buildRoutes(e){return[{path:"root",component:E},{path:":hash",component:E},...Object(D.b)(e,{redirectTo:"root",pathMatch:"full"})]}let O=(()=>{class AddonPrivateFilesLazyModule{}return AddonPrivateFilesLazyModule.ɵmod=g.wc({type:AddonPrivateFilesLazyModule}),AddonPrivateFilesLazyModule.ɵinj=g.vc({factory:function AddonPrivateFilesLazyModule_Factory(e){return new(e||AddonPrivateFilesLazyModule)},providers:[{provide:T.g,multi:!0,deps:[g.x],useFactory:buildRoutes}],imports:[[o.a],T.m]}),AddonPrivateFilesLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&g.kd(O,{declarations:[E],imports:[o.a],exports:[T.m]}))}}]);